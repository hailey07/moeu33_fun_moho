<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„æºæ€»ç´¢å¼•</title>
    <base href="/">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/Favicon.png" type="image/png">
</head>
<body>
    <div class="detail-container" style="width: 100%; max-width: 1200px;">
        <div class="breadcrumb">
            <span class="home-icon" style="display:inline-flex; align-items:center; vertical-align:middle; width:30px;">
                <img src="assets/Favicon.png" alt="Home" class="breadcrumb-home-icon">
            </span>
            <a href="index.html" class="breadcrumb-link">è¿”å›é¦–é¡µ</a> ï½œ <span id="bread-name">ç´¢å¼•</span>
        </div>

        <div id="loading">
            <img src="assets/loading.gif" alt="Loading..." style="width: 150px; height: 150px; margin: 10px auto; display:block;">
        </div>

        <div id="listing-content" style="display:none; padding-bottom: 50px;">
            <div class="listing-header">
                <h1>ğŸ“š èµ„æºæ€»ç´¢å¼•</h1>
                <p>ç‚¹å‡»ä¸‹æ–¹çš„æ ‡ç­¾ï¼Œå¿«é€Ÿåœ¨é¦–é¡µç­›é€‰ç›¸å…³èµ„æºã€‚</p>
            </div>

            <div class="listing-section">
                <h2>ğŸ·ï¸ åˆ†ç±»</h2>
                <div class="tag-cloud" id="cloud-category"></div>
            </div>

            <hr class="listing-divider">

            <div class="listing-section">
                <h2>ğŸ‘¤ ä½œè€…</h2>
                <div class="tag-cloud" id="cloud-author"></div>
            </div>
            
            <hr class="listing-divider">

            <div class="listing-section">
                <h2>ğŸ”– æ ‡ç­¾</h2>
                <div class="tag-cloud" id="cloud-tags"></div>
            </div>

            <hr class="listing-divider">

            <div class="listing-section">
                <h2>âš™ï¸ æœ€ä½é€‚é…</h2>
                <div class="tag-cloud" id="cloud-ver"></div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('data.json')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('listing-content').style.display = 'block';
                    generateClouds(data);
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('loading').innerHTML = "æ•°æ®åŠ è½½å¤±è´¥";
                });
        });

        function generateClouds(data) {
            // æå–æ•°æ®çš„è¾…åŠ©å‡½æ•°
            const extract = (key) => {
                let all = [];
                data.forEach(item => {
                    let val = item[key];
                    if (!val) return;
                    if (Array.isArray(val)) {
                        all.push(...val);
                    } else if (typeof val === 'string') {
                        // å¤„ç†é€—å·åˆ†éš”çš„æƒ…å†µï¼Œå¦‚ "Author A, Author B"
                        if (val.includes(',')) {
                            all.push(...val.split(',').map(s => s.trim()));
                        } else {
                            all.push(val);
                        }
                    }
                });
                // ç»Ÿè®¡é¢‘ç‡ { "Name": 5, "Name2": 1 }
                const counts = {};
                all.forEach(x => { counts[x] = (counts[x] || 0) + 1; });
                return counts;
            };

            // æ¸²æŸ“æ ‡ç­¾äº‘
            const renderCloud = (containerId, counts, colorClass) => {
                const container = document.getElementById(containerId);
                // æŒ‰æ•°é‡å€’åºæ’åºï¼Œæ•°é‡ç›¸åŒæ—¶æŒ‰é¦–å­—æ¯æ’åº
                const sortedKeys = Object.keys(counts).sort((a, b) => {
                    if (counts[b] !== counts[a]) return counts[b] - counts[a];
                    return a.localeCompare(b, 'zh-CN');
                });

                sortedKeys.forEach(key => {
                    const count = counts[key];
                    const a = document.createElement('a');
                    // è·³è½¬å› index.html å¹¶å¸¦ä¸Šæœç´¢å‚æ•° q
                    a.href = `index.html?q=${encodeURIComponent(key)}`;
                    a.className = `tag-badge ${colorClass} listing-tag`;
                    a.innerHTML = `${key} <span class="tag-count">${count}</span>`;
                    container.appendChild(a);
                });
            };

            renderCloud('cloud-category', extract('category'), 'tag-blue');
            renderCloud('cloud-author', extract('author'), 'tag-purple');
            renderCloud('cloud-tags', extract('tags'), 'tag-orange');
            renderCloud('cloud-ver', extract('supportVer'), 'tag-green');
        }
    </script>
</body>
</html>