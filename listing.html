<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        资源总索引</title>
    <base href="/">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/c/font_5109131_wfhaps8fl5.css">
    <link rel="icon" href="assets/Favicon.png" type="image/png">
</head>

<body>
    <div class="detail-container" style="width: 100%;">

        <div class="breadcrumb">
            <div class="detail-topbar">
                <span class="home-icon" href="index"
                    style="display:inline-flex; align-items:center; vertical-align:middle; width:30px;">
                    <img src="assets/Favicon.png" alt="Home" class="breadcrumb-home-icon">
                </span>
                <a href="index" class="breadcrumb-link">返回首页</a> ｜ <span id="bread-name"
                    class="script-name">加载中...</span>

            </div>
            <button id="theme-toggle" class="theme-toggle-btn" onclick="toggleTheme()" title="切换日夜模式"></button>
        </div>
        <div id="loading">
            <img src="assets/loading.gif" alt="Loading..."
                style="width: 150px; height: 150px; margin: 10px auto; display:block;">
        </div>
        <div id="listing-content" style="display:none; padding-bottom: 50px;">
            <div class="listing-header">
                <h1>
                    <svg class="icon-svg" aria-hidden="true">
                        <use xlink:href="#icon-dangan"></use>
                    </svg>资源总索引
                </h1>
                <p></p>
            </div>
            <div class="listing-section">
                <h2>
                    <svg class="icon-svg" aria-hidden="true">
                        <use xlink:href="#icon-suoshuleibie"></use>
                    </svg>分类
                </h2>
                <div class="tag-cloud" id="cloud-category"></div>
            </div>
            <hr class="listing-divider">
            <div class="listing-section">
                <h2>
                    <svg class="icon-svg" aria-hidden="true">
                        <use xlink:href="#icon-author"></use>
                    </svg>作者
                </h2>
                <div class="tag-cloud" id="cloud-author"></div>
            </div>
            <hr class="listing-divider">
            <div class="listing-section">
                <h2>
                    <svg class="icon-svg" aria-hidden="true">
                        <use xlink:href="#icon-tag1"></use>
                    </svg>标签
                </h2>
                <div class="tag-cloud" id="cloud-tags"></div>
            </div>
            <hr class="listing-divider">
            <div class="listing-section">
                <h2>
                    <svg class="icon-svg" aria-hidden="true">
                        <use xlink:href="#icon-Moho-icon"></use>
                    </svg>最低适配
                </h2>
                <div class="tag-cloud" id="cloud-ver"></div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('data.json')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('listing-content').style.display = 'block';
                    generateClouds(data);
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('loading').innerHTML = "数据加载失败";
                });
        });
        function generateClouds(data) {
            // 提取数据的辅助函数
            const extract = (key) => {
                let all = [];
                data.forEach(item => {
                    let val = item[key];
                    if (!val) return;
                    if (Array.isArray(val)) {
                        all.push(...val);
                    } else if (typeof val === 'string') {
                        // 处理逗号分隔的情况，如 "Author A, Author B"
                        if (val.includes(',')) {
                            all.push(...val.split(',').map(s => s.trim()));
                        } else {
                            all.push(val);
                        }
                    }
                });
                // 统计频率 { "Name": 5, "Name2": 1 }
                const counts = {};
                all.forEach(x => { counts[x] = (counts[x] || 0) + 1; });
                return counts;
            };
            // 渲染标签云
            const renderCloud = (containerId, counts, colorClass) => {
                const container = document.getElementById(containerId);
                // 按数量倒序排序，数量相同时按首字母排序
                const sortedKeys = Object.keys(counts).sort((a, b) => {
                    if (counts[b] !== counts[a]) return counts[b] - counts[a];
                    return a.localeCompare(b, 'zh-CN');
                });
                sortedKeys.forEach(key => {
                    const count = counts[key];
                    const a = document.createElement('a');
                    // 跳转回 index.html 并带上搜索参数 q
                    a.href = `index.html?q=${encodeURIComponent(key)}`;
                    a.className = `tag-badge ${colorClass} listing-tag`;
                    a.innerHTML = `${key} <span class="tag-count">${count}</span>`;
                    container.appendChild(a);
                });
            };
            renderCloud('cloud-category', extract('category'), 'tag-blue');
            renderCloud('cloud-author', extract('author'), 'tag-purple');
            renderCloud('cloud-tags', extract('tags'), 'tag-orange');
            renderCloud('cloud-ver', extract('supportVer'), 'tag-green');
        }
    </script>
    <script src="https://at.alicdn.com/t/c/font_5109131_e8j9zarzsw.js"></script>
    <script src="script.js"></script>
</body>
<div id="copyright" class="cr-text">
        ©️ 2026 by MoeU33
    </div>
</html>